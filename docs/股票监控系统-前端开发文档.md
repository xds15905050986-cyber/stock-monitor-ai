# è‚¡ç¥¨ç›‘æ§ç³»ç»Ÿ V1.0 â€” å‰ç«¯å¼€å‘æ–‡æ¡£

> ç‰ˆæœ¬ 1.0.0 Â· 2026-02-25

---

## ç›®å½•

1. [æŠ€æœ¯é€‰å‹ä¸é¡¹ç›®ç»“æ„](#ç¬¬ä¸€ç« æŠ€æœ¯é€‰å‹ä¸é¡¹ç›®ç»“æ„)
2. [ç¯å¢ƒé…ç½®ä¸å¿«é€Ÿå¯åŠ¨](#ç¬¬äºŒç« ç¯å¢ƒé…ç½®ä¸å¿«é€Ÿå¯åŠ¨)
3. [API è¯·æ±‚å°è£…](#ç¬¬ä¸‰ç« api-è¯·æ±‚å°è£…)
4. [çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰](#ç¬¬å››ç« çŠ¶æ€ç®¡ç†pinia)
5. [è·¯ç”±é…ç½®](#ç¬¬äº”ç« è·¯ç”±é…ç½®)
6. [é¡µé¢è®¾è®¡è§„èŒƒ](#ç¬¬å…­ç« é¡µé¢è®¾è®¡è§„èŒƒ)
7. [ç®¡ç†å‘˜ä¸“å±é¡µé¢](#ç¬¬ä¸ƒç« ç®¡ç†å‘˜ä¸“å±é¡µé¢)
8. [é€šç”¨å·¥å…·å‡½æ•°](#ç¬¬å…«ç« é€šç”¨å·¥å…·å‡½æ•°)
9. [å¸ƒå±€ç»„ä»¶è®¾è®¡](#ç¬¬ä¹ç« å¸ƒå±€ç»„ä»¶è®¾è®¡)
10. [å‰ç«¯æ„å»ºä¸éƒ¨ç½²](#ç¬¬åç« å‰ç«¯æ„å»ºä¸éƒ¨ç½²)
11. [å¼€å‘å»ºè®®ä¸æ³¨æ„äº‹é¡¹](#ç¬¬åä¸€ç« å¼€å‘å»ºè®®ä¸æ³¨æ„äº‹é¡¹)

---

## ç¬¬ä¸€ç« ï¼šæŠ€æœ¯é€‰å‹ä¸é¡¹ç›®ç»“æ„

### 1.1 æ¨èæŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®å‰ç«¯æ¨èä½¿ç”¨ **Vue 3 + Vite** æ–¹æ¡ˆï¼Œé€‚åˆä¸­å°å‹ç®¡ç†åå°ï¼Œä¸Šæ‰‹å¿«ï¼Œç”Ÿæ€æˆç†Ÿã€‚

| åˆ†ç±» | æ¨èåº“ | ç‰ˆæœ¬ | ç”¨é€” |
|---|---|---|---|
| æ¡†æ¶ | Vue 3 | 3.x | å“åº”å¼ UI æ¡†æ¶ |
| æ„å»ºå·¥å…· | Vite | 5.x | å¼€å‘æœåŠ¡å™¨ + æ‰“åŒ… |
| è·¯ç”± | Vue Router | 4.x | é¡µé¢è·¯ç”±ç®¡ç† |
| çŠ¶æ€ç®¡ç† | Pinia | 2.x | å…¨å±€çŠ¶æ€ï¼ˆToken / ç”¨æˆ·ä¿¡æ¯ï¼‰ |
| UI ç»„ä»¶åº“ | Element Plus | 2.x | è¡¨æ ¼ã€è¡¨å•ã€å¼¹çª—ç­‰ç»„ä»¶ |
| HTTP è¯·æ±‚ | Axios | 1.x | å°è£… API è¯·æ±‚ã€æ‹¦æˆªå™¨ |
| å›¾è¡¨ | ECharts / vue-echarts | 5.x | è¡Œæƒ…èµ°åŠ¿å›¾ï¼ˆå¯é€‰ï¼‰ |
| CSS æ¡†æ¶ | Tailwind CSS | 3.x | å¿«é€Ÿå¸ƒå±€ï¼ˆå¯é€‰ï¼Œä¸ Element Plus é…åˆï¼‰ |

### 1.2 é¡¹ç›®ç›®å½•ç»“æ„

```
stock-monitor-frontend/
â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js                  # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.vue                  # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ router/                  # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ stores/                  # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.js              # ç”¨æˆ·ç™»å½•çŠ¶æ€ & Token
â”‚   â”‚   â””â”€â”€ app.js               # å…¨å±€åº”ç”¨çŠ¶æ€
â”‚   â”œâ”€â”€ api/                     # API è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ request.js           # Axios å®ä¾‹ + æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ auth.js              # è®¤è¯ç›¸å…³æ¥å£
â”‚   â”‚   â”œâ”€â”€ stocks.js            # è‡ªé€‰è‚¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ rules.js             # ç›‘æ§è§„åˆ™æ¥å£
â”‚   â”‚   â”œâ”€â”€ logs.js              # æ—¥å¿—æ¥å£
â”‚   â”‚   â””â”€â”€ admin.js             # ç®¡ç†å‘˜æ¥å£
â”‚   â”œâ”€â”€ views/                   # é¡µé¢è§†å›¾ï¼ˆå¯¹åº”è·¯ç”±ï¼‰
â”‚   â”‚   â”œâ”€â”€ Login.vue            # ç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ Dashboard.vue        # ä»ªè¡¨ç›˜ï¼ˆé¦–é¡µï¼‰
â”‚   â”‚   â”œâ”€â”€ Stocks.vue           # è‡ªé€‰è‚¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ Rules.vue            # ç›‘æ§è§„åˆ™
â”‚   â”‚   â”œâ”€â”€ Logs.vue             # æŠ¥è­¦æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ Profile.vue          # ä¸ªäººè®¾ç½®
â”‚   â”‚   â””â”€â”€ admin/               # ç®¡ç†å‘˜ä¸“å±é¡µé¢
â”‚   â”‚       â”œâ”€â”€ Users.vue        # ç”¨æˆ·ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ DataSources.vue  # æ•°æ®æºé…ç½®
â”‚   â”‚       â””â”€â”€ SystemLogs.vue   # ç³»ç»Ÿæ—¥å¿—
â”‚   â”œâ”€â”€ components/              # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.vue    # ä¸»å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ  + å†…å®¹åŒºï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.vue      # ä¾§è¾¹å¯¼èˆª
â”‚   â”‚   â”‚   â””â”€â”€ TopBar.vue       # é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”‚   â”œâ”€â”€ stock/               # è‡ªé€‰è‚¡ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ StockCard.vue    # è‚¡ç¥¨å¡ç‰‡
â”‚   â”‚   â”‚   â””â”€â”€ AddStockDialog.vue  # æ·»åŠ è‚¡ç¥¨å¼¹çª—
â”‚   â”‚   â””â”€â”€ common/              # é€šç”¨ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ ProfitTag.vue    # ç›ˆäºæ ‡ç­¾ï¼ˆçº¢ç»¿è‰²ï¼‰
â”‚   â”‚       â””â”€â”€ StatusBadge.vue  # äº¤æ˜“çŠ¶æ€å¾½ç« 
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ format.js            # æ•°å­— / æ—¥æœŸæ ¼å¼åŒ–
â”‚       â””â”€â”€ auth.js              # Token å­˜å–å·¥å…·
â”œâ”€â”€ .env.development             # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production              # ç”Ÿäº§ç¯å¢ƒå˜é‡
â””â”€â”€ vite.config.js               # Vite é…ç½®ï¼ˆå«ä»£ç†ï¼‰
```

---

## ç¬¬äºŒç« ï¼šç¯å¢ƒé…ç½®ä¸å¿«é€Ÿå¯åŠ¨

### 2.1 åˆå§‹åŒ–é¡¹ç›®

```bash
# åˆ›å»º Vue 3 + Vite é¡¹ç›®
npm create vue@latest stock-monitor-frontend
# é€‰é¡¹ï¼šRouter âœ“  Pinia âœ“  ESLint âœ“  å…¶ä½™é»˜è®¤

cd stock-monitor-frontend
npm install

# å®‰è£…ä¸šåŠ¡ä¾èµ–
npm install axios element-plus @element-plus/icons-vue
npm install pinia vue-router
```

### 2.2 ç¯å¢ƒå˜é‡

**`.env.development`ï¼ˆå¼€å‘ç¯å¢ƒï¼‰**

```env
VITE_API_BASE_URL=http://localhost:8001
VITE_APP_TITLE=è‚¡ç¥¨ç›‘æ§ç³»ç»Ÿ
```

**`.env.production`ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**

```env
VITE_API_BASE_URL=http://your-server-ip:8001
VITE_APP_TITLE=è‚¡ç¥¨ç›‘æ§ç³»ç»Ÿ
```

### 2.3 Vite ä»£ç†é…ç½®ï¼ˆè§£å†³å¼€å‘è·¨åŸŸï¼‰

```js
// vite.config.js
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8001',
        changeOrigin: true,
      }
    }
  }
})
```

---

## ç¬¬ä¸‰ç« ï¼šAPI è¯·æ±‚å°è£…

### 3.1 Axios å®ä¾‹ + æ‹¦æˆªå™¨ï¼ˆ`src/api/request.js`ï¼‰

æ‰€æœ‰æ¥å£è¯·æ±‚ç»Ÿä¸€èµ°æ­¤æ–‡ä»¶ï¼Œ**è‡ªåŠ¨é™„åŠ  Tokenã€ç»Ÿä¸€å¤„ç† 401 / 403 é”™è¯¯**ï¼š

```js
import axios from 'axios'
import { ElMessage } from 'element-plus'
import router from '@/router'

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 15000,
})

// è¯·æ±‚æ‹¦æˆªï¼šè‡ªåŠ¨åŠ  Token
request.interceptors.request.use(config => {
  const token = localStorage.getItem('access_token')
  if (token) config.headers.Authorization = `Bearer ${token}`
  return config
})

// å“åº”æ‹¦æˆªï¼šç»Ÿä¸€é”™è¯¯å¤„ç†
request.interceptors.response.use(
  res => res.data,
  err => {
    const status = err.response?.status
    if (status === 401) {
      localStorage.removeItem('access_token')
      router.push('/login')
      ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
    } else if (status === 403) {
      ElMessage.error('æƒé™ä¸è¶³')
    } else {
      ElMessage.error(err.response?.data?.detail || 'è¯·æ±‚å¤±è´¥')
    }
    return Promise.reject(err)
  }
)

export default request
```

### 3.2 å„æ¨¡å—æ¥å£å‡½æ•°

#### è®¤è¯æ¨¡å—ï¼ˆ`src/api/auth.js`ï¼‰

```js
import request from './request'

export const login        = (data) => request.post('/api/v1/auth/login', data)
export const register     = (data) => request.post('/api/v1/auth/register', data)
export const getProfile   = ()     => request.get('/api/v1/auth/profile')
export const updateProfile= (data) => request.put('/api/v1/auth/profile', data)
```

#### è‡ªé€‰è‚¡æ¨¡å—ï¼ˆ`src/api/stocks.js`ï¼‰

```js
import request from './request'

export const getDashboard = ()        => request.get('/api/v1/dashboard')
export const getStocks    = ()        => request.get('/api/v1/stocks')
export const addStock     = (data)    => request.post('/api/v1/stocks', data)
export const updateStock  = (id, data)=> request.put(`/api/v1/stocks/${id}`, data)
export const deleteStock  = (id)      => request.delete(`/api/v1/stocks/${id}`)
```

#### ç›‘æ§è§„åˆ™æ¨¡å—ï¼ˆ`src/api/rules.js`ï¼‰

```js
import request from './request'

export const getRules    = (params)    => request.get('/api/v1/rules', { params })
export const createRule  = (data)      => request.post('/api/v1/rules', data)
export const updateRule  = (id, data)  => request.put(`/api/v1/rules/${id}`, data)
export const deleteRule  = (id)        => request.delete(`/api/v1/rules/${id}`)
```

#### æ—¥å¿—æ¨¡å—ï¼ˆ`src/api/logs.js`ï¼‰

```js
import request from './request'

export const getAlertLogs  = (params) => request.get('/api/v1/logs/alerts', { params })
export const getSystemLogs = (params) => request.get('/api/v1/logs/system', { params })
export const getPositions  = ()       => request.get('/api/v1/logs/positions')
```

#### ç®¡ç†å‘˜æ¨¡å—ï¼ˆ`src/api/admin.js`ï¼‰

```js
import request from './request'

export const getUsers         = (params)       => request.get('/api/v1/admin/users', { params })
export const updateUserRole   = (id, role)     => request.put(`/api/v1/admin/users/${id}`, null, { params: { role } })
export const getDataSources   = ()             => request.get('/api/v1/admin/data-sources')
export const updateDataSource = (market, data) => request.put(`/api/v1/admin/data-sources/${market}`, data)
export const getSystemStatus  = ()             => request.get('/api/v1/system/status')
export const forceRefresh     = ()             => request.post('/api/v1/system/refresh')
```

---

## ç¬¬å››ç« ï¼šçŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

### 4.1 ç”¨æˆ·çŠ¶æ€ï¼ˆ`src/stores/auth.js`ï¼‰

```js
import { defineStore } from 'pinia'
import { login as loginApi, getProfile } from '@/api/auth'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    token: localStorage.getItem('access_token') || '',
    user: null,
  }),
  getters: {
    isLoggedIn: (s) => !!s.token,
    isAdmin:    (s) => s.user?.role === 'admin',
  },
  actions: {
    async login(credentials) {
      const res = await loginApi(credentials)
      this.token = res.access_token
      localStorage.setItem('access_token', res.access_token)
      await this.fetchProfile()
    },
    async fetchProfile() {
      this.user = await getProfile()
    },
    logout() {
      this.token = ''
      this.user  = null
      localStorage.removeItem('access_token')
    },
  }
})
```

---

## ç¬¬äº”ç« ï¼šè·¯ç”±é…ç½®

### 5.1 è·¯ç”±è¡¨ï¼ˆ`src/router/index.js`ï¼‰

```js
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const routes = [
  { path: '/login', component: () => import('@/views/Login.vue'), meta: { public: true } },
  { path: '/',      redirect: '/dashboard' },
  {
    path: '/',
    component: () => import('@/components/layout/AppLayout.vue'),
    children: [
      { path: 'dashboard', component: () => import('@/views/Dashboard.vue') },
      { path: 'stocks',    component: () => import('@/views/Stocks.vue') },
      { path: 'rules',     component: () => import('@/views/Rules.vue') },
      { path: 'logs',      component: () => import('@/views/Logs.vue') },
      { path: 'profile',   component: () => import('@/views/Profile.vue') },
      // ç®¡ç†å‘˜è·¯ç”±
      { path: 'admin/users',        component: () => import('@/views/admin/Users.vue'),       meta: { adminOnly: true } },
      { path: 'admin/datasources',  component: () => import('@/views/admin/DataSources.vue'), meta: { adminOnly: true } },
      { path: 'admin/system-logs',  component: () => import('@/views/admin/SystemLogs.vue'),  meta: { adminOnly: true } },
    ]
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

// è·¯ç”±å®ˆå«ï¼šæœªç™»å½•è·³è½¬ /loginï¼Œéç®¡ç†å‘˜æ‹¦æˆª admin è·¯ç”±
router.beforeEach((to) => {
  const auth = useAuthStore()
  if (!to.meta.public && !auth.isLoggedIn) return '/login'
  if (to.meta.adminOnly && !auth.isAdmin)  return '/dashboard'
})

export default router
```

---

## ç¬¬å…­ç« ï¼šé¡µé¢è®¾è®¡è§„èŒƒ

### 6.1 ç™»å½•é¡µï¼ˆ`Login.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šç”¨æˆ·å + å¯†ç ç™»å½•ï¼Œç™»å½•æˆåŠŸè·³è½¬ä»ªè¡¨ç›˜ï¼ŒToken å­˜å…¥ localStorageã€‚

```vue
<template>
  <div class="login-page">  <!-- å±…ä¸­å¸ƒå±€ï¼ŒèƒŒæ™¯æ¸å˜ -->
    <el-card class="login-card">
      <h2>è‚¡ç¥¨ç›‘æ§ç³»ç»Ÿ</h2>
      <el-form :model="form" :rules="rules" ref="formRef">
        <el-form-item prop="username">
          <el-input v-model="form.username" placeholder="ç”¨æˆ·å" />
        </el-form-item>
        <el-form-item prop="password">
          <el-input v-model="form.password" type="password" placeholder="å¯†ç " show-password />
        </el-form-item>
        <el-button type="primary" @click="handleLogin" :loading="loading" style="width:100%">
          ç™»å½•
        </el-button>
      </el-form>
    </el-card>
  </div>
</template>

<script setup>
const handleLogin = async () => {
  await formRef.value.validate()
  loading.value = true
  try {
    await authStore.login(form)
    router.push('/dashboard')
  } finally {
    loading.value = false
  }
}
</script>
```

---

### 6.2 ä»ªè¡¨ç›˜ï¼ˆ`Dashboard.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šå±•ç¤ºè‡ªé€‰è‚¡å®æ—¶è¡Œæƒ…ã€ç›ˆäºæ±‡æ€»å¡ç‰‡ï¼Œæ”¯æŒæ‰‹åŠ¨åˆ·æ–°ï¼Œæ¯ 30 ç§’è‡ªåŠ¨è½®è¯¢ã€‚

#### é¡¶éƒ¨æ±‡æ€»å¡ç‰‡ï¼ˆ4 ä¸ªï¼‰

| å¡ç‰‡æ ‡é¢˜ | æ•°æ®å­—æ®µ | é¢œè‰²é€»è¾‘ |
|---|---|---|
| æ€»å¸‚å€¼ | `summary.total_market_value` | è“è‰²å›ºå®š |
| æ€»æˆæœ¬ | `summary.total_cost` | ç°è‰²å›ºå®š |
| æ€»ç›ˆäº | `summary.total_profit_loss` | æ­£æ•°ç»¿è‰² / è´Ÿæ•°çº¢è‰² |
| ç›ˆäºæ¯”ä¾‹ | `summary.total_profit_loss_pct` | æ­£æ•°ç»¿è‰² / è´Ÿæ•°çº¢è‰² |

#### è¡Œæƒ…è¡¨æ ¼åˆ—å®šä¹‰

| åˆ—å | æ•°æ®å­—æ®µ | æ ¼å¼ | å¤‡æ³¨ |
|---|---|---|---|
| è‚¡ç¥¨ä»£ç  | `stock_code` | æ–‡æœ¬ | |
| è‚¡ç¥¨åç§° | `stock_name` | æ–‡æœ¬ | |
| å¸‚åœº | `market` | CN / HK / US å¾½ç«  | |
| å½“å‰ä»· | `price` | ä¿ç•™ 2 ä½å°æ•° | æŠ“å–å¤±è´¥æ˜¾ç¤º `--` |
| æ¶¨è·Œå¹… | `change_pct` | `Â±x.xx%` | æ­£æ•°ç»¿è‰²â†‘ è´Ÿæ•°çº¢è‰²â†“ |
| æˆæœ¬ä»· | `cost_price` | ä¿ç•™ 2 ä½å°æ•° | 0 æ˜¾ç¤º `--` |
| æŒä»“é‡ | `quantity` | æ•´æ•° | 0 æ˜¾ç¤º `--` |
| ç›ˆäºé‡‘é¢ | `profit_loss` | `Â±Â¥x,xxx.xx` | æ­£ç»¿è´Ÿçº¢ |
| ç›ˆäºæ¯”ä¾‹ | `profit_loss_pct` | `Â±x.xx%` | æ­£ç»¿è´Ÿçº¢ |
| äº¤æ˜“çŠ¶æ€ | `status` | å¾½ç«  | äº¤æ˜“ä¸­ / å·²æ”¶ç›˜ / ç›˜å‰/ç›˜å / æ•°æ®å¼‚å¸¸ |
| æ“ä½œ | â€” | æŒ‰é’® | ç¼–è¾‘æŒä»“ / è®¾ç½®è§„åˆ™ / åˆ é™¤ |

#### è‡ªåŠ¨è½®è¯¢é€»è¾‘

```js
onMounted(() => {
  fetchDashboard()
  // æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
  timer = setInterval(fetchDashboard, 30000)
})
onUnmounted(() => clearInterval(timer))
```

> ğŸ’¡ äº¤æ˜“æ—¶æ®µï¼ˆA è‚¡ 9:30â€“11:30 / 13:00â€“15:00ï¼‰å¯ç¼©çŸ­åˆ° 10sï¼Œéäº¤æ˜“æ—¶æ®µå»¶é•¿åˆ° 60sï¼Œå‡å°‘æ— æ•ˆè¯·æ±‚ã€‚

---

### 6.3 è‡ªé€‰è‚¡ç®¡ç†ï¼ˆ`Stocks.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šæŸ¥çœ‹ã€æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤è‡ªé€‰è‚¡ã€‚

#### æ·»åŠ è‚¡ç¥¨å¼¹çª—å­—æ®µ

| å­—æ®µ | ç»„ä»¶ | æ ¡éªŒè§„åˆ™ | è¯´æ˜ |
|---|---|---|---|
| è‚¡ç¥¨ä»£ç  | `el-input` | å¿…å¡«ï¼Œè‡ªåŠ¨è½¬å¤§å†™ | å¦‚ 600519ã€AAPL |
| å¸‚åœº | `el-select` | å¿…å¡«ï¼ŒCN / HK / US ä¸‰é€‰ä¸€ | å†³å®šç”¨å“ªä¸ªæ•°æ®æº |
| æˆæœ¬ä»· | `el-input-number` | â‰¥ 0ï¼Œé»˜è®¤ 0 | 0 ä»£è¡¨åªå…³æ³¨ä¸æŒä»“ |
| æŒä»“é‡ | `el-input-number` | æ•´æ•° â‰¥ 0ï¼Œé»˜è®¤ 0 | 0 ä»£è¡¨åªå…³æ³¨ä¸æŒä»“ |
| å¤‡æ³¨ | `el-input` | å¯é€‰ï¼Œæœ€å¤š 256 å­— | å¦‚ åº•ä»“ã€åŠ ä»“ |

> ğŸ’¡ è‚¡ç¥¨ä»£ç æäº¤å‰ç»Ÿä¸€è½¬å¤§å†™ï¼š`stockCode.toUpperCase()`

---

### 6.4 ç›‘æ§è§„åˆ™ï¼ˆ`Rules.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šä¸ºè‡ªé€‰è‚¡é…ç½®ä»·æ ¼ / æ¶¨è·Œå¹… / ç›ˆäºæŠ¥è­¦è§„åˆ™ï¼Œæ”¯æŒé‡ç½®è§¦å‘ã€‚

#### æ¡ä»¶ç±»å‹è¯´æ˜

| condition å€¼ | ä¸­æ–‡æè¿° | ç›®æ ‡å€¼ç¤ºä¾‹ |
|---|---|---|
| `price_low` | è‚¡ä»·è·Œç ´ | `1500`ï¼ˆå…ƒï¼‰ |
| `price_high` | è‚¡ä»·çªç ´ | `2000`ï¼ˆå…ƒï¼‰ |
| `change_pct_up` | ä»Šæ—¥æ¶¨å¹…è¶…è¿‡ | `5`ï¼ˆ%ï¼‰ |
| `change_pct_down` | ä»Šæ—¥è·Œå¹…è¶…è¿‡ | `-5`ï¼ˆ%ï¼Œè¾“å…¥è´Ÿæ•°ï¼‰ |
| `cost_profit_pct` | æŒä»“ç›ˆåˆ©æ¯”ä¾‹è¶…è¿‡ | `10`ï¼ˆ%ï¼‰ |
| `cost_loss_pct` | æŒä»“äºæŸæ¯”ä¾‹è¶…è¿‡ | `-5`ï¼ˆ%ï¼Œè¾“å…¥è´Ÿæ•°ï¼‰ |

#### è§„åˆ™åˆ—è¡¨æ“ä½œæŒ‰é’®

| æ“ä½œ | API è°ƒç”¨ | è¯´æ˜ |
|---|---|---|
| å¯ç”¨ / ç¦ç”¨ | `updateRule(id, { is_active: bool })` | åˆ‡æ¢è§„åˆ™ç”Ÿæ•ˆçŠ¶æ€ |
| é‡ç½®è§¦å‘ | `updateRule(id, { reset_trigger: true })` | å·²è§¦å‘çš„è§„åˆ™é‡ç½®ï¼Œå¯å†æ¬¡è§¦å‘æŠ¥è­¦ |
| ä¿®æ”¹ç›®æ ‡å€¼ | `updateRule(id, { target_value: val })` | ä¿®æ”¹æŠ¥è­¦é˜ˆå€¼ |
| åˆ é™¤ | `deleteRule(id)` | æ°¸ä¹…åˆ é™¤è§„åˆ™ |

> âš ï¸ `is_triggered = true` æ—¶è¯¥è¡Œæ˜¾ç¤ºé»„è‰²è­¦å‘ŠèƒŒæ™¯ï¼Œæç¤ºç”¨æˆ·æ­¤è§„åˆ™å·²è§¦å‘è¿‡ï¼Œéœ€æ‰‹åŠ¨é‡ç½®æ‰ä¼šå†æ¬¡å‘é‚®ä»¶ã€‚

---

### 6.5 æŠ¥è­¦æ—¥å¿—ï¼ˆ`Logs.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šæŸ¥çœ‹æŠ¥è­¦å†å²è®°å½•ï¼Œæ”¯æŒæŒ‰è‚¡ç¥¨ä»£ç ç­›é€‰ï¼Œåˆ†é¡µå±•ç¤ºã€‚

#### æ—¥å¿—è¡¨æ ¼åˆ—

| åˆ—å | å­—æ®µ | å¤‡æ³¨ |
|---|---|---|
| è§¦å‘æ—¶é—´ | `trigger_time` | æ ¼å¼ï¼š`2026-02-24 15:30:00` |
| è‚¡ç¥¨ä»£ç  | `stock_code` | |
| è§¦å‘ä»·æ ¼ | `trigger_price` | ä¿ç•™ 2 ä½å°æ•° |
| é‚®ä»¶çŠ¶æ€ | `email_status` | `success` ç»¿è‰² âœ“ / `fail` çº¢è‰² âœ— / `pending` ç°è‰² |
| å…³è”è§„åˆ™ ID | `rule_id` | å¯ç‚¹å‡»è·³è½¬åˆ°è§„åˆ™é¡µ |

---

### 6.6 ä¸ªäººè®¾ç½®ï¼ˆ`Profile.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šä¿®æ”¹é‚®ç®±ã€SMTP é…ç½®ã€å¯†ç ï¼Œåˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹è¡¨å•å¡ç‰‡ã€‚

#### é‚®ç®± / SMTP é…ç½®å¡ç‰‡

| å­—æ®µ | è¯´æ˜ | é»˜è®¤å€¼ |
|---|---|---|
| æ¥æ”¶é‚®ç®± `email` | æ”¶æŠ¥è­¦é€šçŸ¥çš„é‚®ç®± | æ³¨å†Œæ—¶å¡«å†™çš„é‚®ç®± |
| SMTP æœåŠ¡å™¨ `smtp_host` | å‘ä»¶æœåŠ¡å™¨åœ°å€ | `smtp.qq.com` |
| SMTP ç«¯å£ `smtp_port` | å‘ä»¶ç«¯å£ | `465` |
| å‘ä»¶è´¦å· `smtp_user` | å‘ä»¶é‚®ç®±è´¦å· | |
| æˆæƒç  `smtp_pass` | QQ é‚®ç®±æˆæƒç ï¼ˆéå¯†ç ï¼‰ | |

> ğŸ’¡ QQ é‚®ç®±æˆæƒç åœ¨ **QQé‚®ç®±è®¾ç½® â†’ è´¦æˆ· â†’ POP3/SMTPæœåŠ¡** ä¸­å¼€å¯åè·å–ï¼Œä¸æ˜¯ QQ å¯†ç ã€‚

#### ä¿®æ”¹å¯†ç å¡ç‰‡

éœ€åŒæ—¶å¡«å†™æ—§å¯†ç å’Œæ–°å¯†ç ï¼Œè°ƒç”¨ `PUT /api/v1/auth/profile` å¹¶ä¼ å…¥ `old_password` + `new_password` å­—æ®µã€‚

---

## ç¬¬ä¸ƒç« ï¼šç®¡ç†å‘˜ä¸“å±é¡µé¢

> ğŸ” ä»¥ä¸‹é¡µé¢ä»… `role = admin` ç”¨æˆ·å¯è®¿é—®ï¼Œè·¯ç”±å®ˆå«ä¼šè‡ªåŠ¨æ‹¦æˆªæ™®é€šç”¨æˆ·ã€‚

### 7.1 ç”¨æˆ·ç®¡ç†ï¼ˆ`admin/Users.vue`ï¼‰

å±•ç¤ºæ‰€æœ‰æ³¨å†Œç”¨æˆ·ï¼Œæ”¯æŒä¿®æ”¹è§’è‰²ï¼ˆ`admin` / `user`ï¼‰ã€‚ä¸æä¾›åˆ é™¤ç”¨æˆ·åŠŸèƒ½ï¼Œé¿å…è¯¯æ“ä½œã€‚

```js
const changeRole = async (userId, newRole) => {
  await ElMessageBox.confirm(`ç¡®è®¤å°†è¯¥ç”¨æˆ·è§’è‰²æ”¹ä¸º ${newRole}ï¼Ÿ`)
  await updateUserRole(userId, newRole)
  ElMessage.success('è§’è‰²å·²æ›´æ–°')
  fetchUsers()
}
```

---

### 7.2 æ•°æ®æºé…ç½®ï¼ˆ`admin/DataSources.vue`ï¼‰

å±•ç¤ºä¸‰ä¸ªå¸‚åœºï¼ˆCN / HK / USï¼‰çš„æ•°æ®æºé…ç½®ï¼Œæ”¯æŒä¿®æ”¹ API Keyã€è½®è¯¢é—´éš”ã€å¯ç”¨ / ç¦ç”¨ã€‚

| å­—æ®µ | è¯´æ˜ | CN é»˜è®¤ | HK / US é»˜è®¤ |
|---|---|---|---|
| æ•°æ®æº | æ˜¾ç¤ºåç§° | Tushare | æ–°æµª |
| API Key | å¯†é’¥ï¼ˆè„±æ•æ˜¾ç¤ºï¼‰ | `â—â—â—â—...da` | æ—  |
| æœ€å°é—´éš”ï¼ˆsï¼‰ | è½®è¯¢æœ€çŸ­é—´éš” | `8` | `15` |
| æœ€å¤§é—´éš”ï¼ˆsï¼‰ | è½®è¯¢æœ€é•¿é—´éš” | `13` | `25` |
| çŠ¶æ€ | å¯ç”¨ / ç¦ç”¨å¼€å…³ | å¯ç”¨ | å¯ç”¨ |

> ğŸ’¡ API Key å±•ç¤ºæ—¶åšè„±æ•å¤„ç†ï¼šåªæ˜¾ç¤ºå‰ 4 ä½å’Œå 4 ä½ï¼Œä¸­é—´ç”¨ `â—â—â—â—` æ›¿ä»£ã€‚

---

### 7.3 ç³»ç»Ÿæ—¥å¿—ï¼ˆ`admin/SystemLogs.vue`ï¼‰

å±•ç¤ºåç«¯ç³»ç»Ÿè¿è¡Œæ—¥å¿—ï¼Œæ”¯æŒæŒ‰ç±»å‹ç­›é€‰ï¼Œå¸®åŠ©æ’æŸ¥æ•°æ®æŠ“å–å¼‚å¸¸ã€‚

```js
// æ—¥å¿—ç±»å‹é¢œè‰²æ˜ å°„
const logTypeTag = {
  info:    'success',
  warning: 'warning',
  error:   'danger',
}
```

---

## ç¬¬å…«ç« ï¼šé€šç”¨å·¥å…·å‡½æ•°

**`src/utils/format.js`**

```js
// æ ¼å¼åŒ–é‡‘é¢ï¼Œå¸¦æ­£è´Ÿå·å’Œåƒåˆ†ä½
export const formatMoney = (val, decimals = 2) => {
  if (val == null) return '--'
  const prefix = val > 0 ? '+' : ''
  return prefix + val.toLocaleString('zh-CN', {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
  })
}

// æ ¼å¼åŒ–æ¶¨è·Œå¹…
export const formatPct = (val) => {
  if (val == null) return '--'
  return (val > 0 ? '+' : '') + val.toFixed(2) + '%'
}

// æ¶¨è·Œé¢œè‰²ï¼ˆä¸­å›½è‚¡å¸‚ï¼šæ¶¨çº¢è·Œç»¿ï¼‰
export const profitColor = (val) => {
  if (val == null) return ''
  return val > 0 ? 'color-red' : val < 0 ? 'color-green' : ''
}

// è‚¡ä»·æ ¼å¼åŒ–
export const formatPrice = (val) => val != null ? val.toFixed(2) : '--'
```

> âš ï¸ A è‚¡ä¹ æƒ¯ï¼šæ¶¨çº¢è·Œç»¿ã€‚å¦‚é¢å‘æµ·å¤–ç”¨æˆ·å¯æ”¹ä¸ºæ¶¨ç»¿è·Œçº¢ï¼Œæå–ä¸ºé…ç½®é¡¹å³å¯ã€‚

---

## ç¬¬ä¹ç« ï¼šå¸ƒå±€ç»„ä»¶è®¾è®¡

### 9.1 ä¸»å¸ƒå±€ï¼ˆ`AppLayout.vue`ï¼‰

æ•´ä½“é‡‡ç”¨ **å·¦ä¾§è¾¹æ  + é¡¶éƒ¨å¯¼èˆª + å³ä¾§å†…å®¹åŒº** ä¸‰æ®µå¼å¸ƒå±€ï¼š

```vue
<template>
  <el-container style="height: 100vh">
    <el-aside width="220px"><Sidebar /></el-aside>
    <el-container>
      <el-header><TopBar /></el-header>
      <el-main><router-view /></el-main>
    </el-container>
  </el-container>
</template>
```

### 9.2 ä¾§è¾¹æ å¯¼èˆªèœå•é¡¹

| èœå•é¡¹ | è·¯ç”± | å¯è§èŒƒå›´ |
|---|---|---|
| ğŸ“Š ä»ªè¡¨ç›˜ | `/dashboard` | æ‰€æœ‰ç”¨æˆ· |
| ğŸ“ˆ è‡ªé€‰è‚¡ç®¡ç† | `/stocks` | æ‰€æœ‰ç”¨æˆ· |
| âš ï¸ ç›‘æ§è§„åˆ™ | `/rules` | æ‰€æœ‰ç”¨æˆ· |
| ğŸ“œ æŠ¥è­¦æ—¥å¿— | `/logs` | æ‰€æœ‰ç”¨æˆ· |
| ğŸ‘¤ ä¸ªäººè®¾ç½® | `/profile` | æ‰€æœ‰ç”¨æˆ· |
| â€” ç®¡ç†å‘˜ â€” | | åˆ†å‰²çº¿ |
| ğŸ‘¥ ç”¨æˆ·ç®¡ç† | `/admin/users` | ä»… admin |
| âš™ï¸ æ•°æ®æºé…ç½® | `/admin/datasources` | ä»… admin |
| ğŸ“‹ ç³»ç»Ÿæ—¥å¿— | `/admin/system-logs` | ä»… admin |

### 9.3 é¡¶éƒ¨å¯¼èˆªæ å†…å®¹

- **å·¦ä¾§**ï¼šç³»ç»Ÿåç§° + å½“å‰é¡µé¢æ ‡é¢˜
- **å³ä¾§**ï¼šå½“å‰ç”¨æˆ·å + è§’è‰²å¾½ç«  + é€€å‡ºç™»å½•æŒ‰é’®

---

## ç¬¬åç« ï¼šå‰ç«¯æ„å»ºä¸éƒ¨ç½²

### 10.1 æœ¬åœ°å¼€å‘

```bash
npm run dev
# è®¿é—® http://localhost:5173
```

### 10.2 ç”Ÿäº§æ„å»º

```bash
npm run build
# äº§ç‰©åœ¨ dist/ ç›®å½•
```

### 10.3 éƒ¨ç½²æ–¹å¼ä¸€ï¼šNginx é™æ€æ‰˜ç®¡ï¼ˆæ¨èï¼‰

```bash
# æŠŠ dist/ å¤åˆ¶åˆ°æœåŠ¡å™¨
scp -r dist/* user@server:/var/www/stock-monitor/
```

Nginx é…ç½®ï¼š

```nginx
server {
    listen 80;
    root /var/www/stock-monitor;
    index index.html;

    # Vue Router history æ¨¡å¼å¿…é¡»åŠ 
    location / {
        try_files $uri $uri/ /index.html;
    }

    # åå‘ä»£ç†åç«¯ API
    location /api/ {
        proxy_pass http://localhost:8001;
    }
}
```

### 10.4 éƒ¨ç½²æ–¹å¼äºŒï¼šDockerï¼ˆä¸åç«¯åŒå®¹å™¨ç¼–æ’ï¼‰

åœ¨åç«¯çš„ `docker-compose.yml` ä¸­æ–°å¢å‰ç«¯æœåŠ¡ï¼š

```yaml
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - api
    networks:
      - stock-net
```

å‰ç«¯ `Dockerfile`ï¼š

```dockerfile
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
```

---

## ç¬¬åä¸€ç« ï¼šå¼€å‘å»ºè®®ä¸æ³¨æ„äº‹é¡¹

### â–¶ å¼€å‘é¡ºåºå»ºè®®

æŒ‰ä»¥ä¸‹é¡ºåºå¼€å‘æ•ˆç‡æœ€é«˜ï¼š

```
â‘  ç™»å½•é¡µ  â†’  â‘¡ ä»ªè¡¨ç›˜ï¼ˆæœ€æ ¸å¿ƒï¼ŒéªŒè¯æ¥å£è”é€šï¼‰  â†’  â‘¢ è‡ªé€‰è‚¡ç®¡ç†
â†’  â‘£ ç›‘æ§è§„åˆ™  â†’  â‘¤ æ—¥å¿—  â†’  â‘¥ ä¸ªäººè®¾ç½®  â†’  â‘¦ ç®¡ç†å‘˜é¡µé¢
```

### â–¶ Token è¿‡æœŸå¤„ç†

Axios å“åº”æ‹¦æˆªå™¨å·²ç»Ÿä¸€å¤„ç† 401ï¼Œè‡ªåŠ¨è·³è½¬åˆ° `/login`ã€‚å»ºè®®åœ¨ `App.vue` çš„ `onMounted` ä¸­è°ƒç”¨ `fetchProfile()` éªŒè¯ Token æœ‰æ•ˆæ€§ï¼Œæ— æ•ˆæ—¶æå‰æ¸…é™¤ã€‚

### â–¶ å®æ—¶æ€§è¯´æ˜

ä»ªè¡¨ç›˜æ•°æ®æ¥æºæ˜¯åç«¯å®šæ—¶è½®è¯¢ï¼ˆ8â€“13 ç§’ä¸€æ¬¡ï¼‰ï¼Œå‰ç«¯æ¯ 30 ç§’æ‹‰å–ä¸€æ¬¡å¿«ç…§å³å¯ï¼Œ**æ— éœ€ WebSocket**ï¼Œé¿å…è¿‡åº¦å¤æ‚ã€‚

### â–¶ æ•°å­—æ ¼å¼è§„èŒƒ

- A è‚¡ä¹ æƒ¯ï¼š**æ¶¨çº¢è·Œç»¿**
- ä»·æ ¼ä¿ç•™ 2 ä½å°æ•°
- é‡‘é¢åŠ åƒåˆ†ä½å’Œ Â¥ å‰ç¼€
- ç™¾åˆ†æ¯”æ˜¾ç¤º Â± ç¬¦å·

### â–¶ ç©ºæ•°æ®å¤„ç†

`price`ã€`profit_loss` ç­‰å­—æ®µåç«¯å¯èƒ½è¿”å› `null`ï¼ˆæ•°æ®æŠ“å–å¤±è´¥ï¼‰ï¼Œå‰ç«¯ç»Ÿä¸€æ˜¾ç¤º `--`ï¼Œé¿å…å‡ºç° `NaN` æˆ– `undefined`ã€‚

### â–¶ ç®¡ç†å‘˜æƒé™åŒå±‚ä¿æŠ¤

ä¾§è¾¹æ èœå•æ ¹æ® `authStore.isAdmin` åŠ¨æ€æ˜¾ç¤ºï¼Œè·¯ç”±å®ˆå«åŒæ­¥æ‹¦æˆªï¼Œ**ä¸¤å±‚ä¿æŠ¤**ï¼Œç¼ºä¸€ä¸å¯ã€‚

### â–¶ SMTP é…ç½®è¯´æ˜

Profile é¡µé¢çš„ `smtp_pass` å­—æ®µè¯´æ˜è¦å†™æ¸…æ¥šï¼šQQ é‚®ç®±å¡«**æˆæƒç **ï¼ˆä¸æ˜¯å¯†ç ï¼‰ï¼Œéœ€åœ¨ **QQé‚®ç®±è®¾ç½® â†’ è´¦æˆ· â†’ POP3/SMTP æœåŠ¡** ä¸­å¼€å¯åè·å–ã€‚

---

*â€” æ–‡æ¡£ç»“æŸ â€”*
